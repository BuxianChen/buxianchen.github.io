---
layout: post
title: "(P0) VAE 浅析"
date: 2024-06-06 15:10:04 +0800
labels: [paper]
---


## 数学基础

两个一元正态分布的 KL 散度计算推导: [https://statproofbook.github.io/P/norm-kl.html](https://statproofbook.github.io/P/norm-kl.html)

多元正态分布的 KL 散度可参考 [wiki](https://en.wikipedia.org/wiki/Kullback%E2%80%93Leibler_divergence)

### 概率空间

概率空间的严格定义: 概率空间是一个三元组 $(\Omega, \mathcal{F}, P)$, 其中

(1) $\Omega$ 是样本空间, 它是一个集合, 即随机事件的所有可能的取值. 例如在离散情形下, 掷骰子的样本空间是 $\Omega=\left\{1, 2, 3, 4, 5, 6\right\}$; 在连续情形下, 一维正态分布的 $\Omega=\mathbb{R}$.

(2) $\mathcal{F}$ 代表事件域, 它需要是定义在 $\Omega$ 上的一个 $\sigma$ 代数: 换句话说, $\mathcal{F}$ 是一个集合, 它每个元素都是 $\Omega$ 的子集, 并且满足以下三个条件:

- 空集属于 $\mathcal{F}$: $\Phi\in\mathcal{F}$
- 如果一个集合 $A$ 属于 $\mathcal{F}$, 那么它相对于全集 $\Omega$ 的补集 $\bar{A}=\Omega\backslash A$ 也属于 $\mathcal{F}$
- 如果**可数个** $A_1, A_2, ...$ 都属于 $\mathcal{F}$, 那么它们的并集 $\bigcup_{i=1}A_i$ 也属于 $\mathcal{F}$.

TODO: 什么是可数个集合的并集

(3) $P$ 代表概率测度, 它是定义在事件域上的一个函数, 且需要满足:

- 对于任意 $A\in\mathcal{F}$, $P(A) \geq 0$
- $P(\Omega)=1$
- 假设**可数个** $A_1,A_2, ...$ 都属于 $\mathcal{F}$, 且**两两不相交**, 那么 $P(\bigcup_{i}A_i)=\sum_{i}{P(A_i)}$

在离散情形投骰子的情形下, 定义样本空间 $\Omega=\left\{1, 2, 3, 4, 5, 6\right\}$, 定义事件域 $\mathcal{F}$ 为 $\Omega$ 的所有可能的子集, 例如: 事件 $\left\{1, 3, 6\right\}$ 代表投出的骰子取值是 ${1, 3, 6}$ 之一. $P(\left\{i\right\})=\frac{1}{6}, i\in\Omega$, 注意对于任意 $A\in\mathcal{F}$, $P(A)$ 就完全被确定了.

在连续情形的标准正态分布的情形下, 定义样本空间 $\Omega=\mathbb{R}$, 而定义事件域是 $\mathbb{R}$ 上的**博雷尔集**, 而概率 $P$ 的定义是:

$$
P(A)=\int_{x\in A}{p(x)dx},
$$

其中

$$
p(x)=\frac{1}{\sqrt{2\pi}}\exp^{-\frac{x^2}{2}}
$$

所谓**博雷尔集**, 有几种定义形式, 都对应着同样的东西:

(1) $\mathbb{R}$ 上可以拆解为可数个开区间的并集或者交集的集合全体构成的集合.

(2) 包含所有开区间的最小 $\sigma$ 代数

博雷尔集的一些性质是: 它包含所有的**开集**和**闭集**(因此开区间和闭区间都在里面), 注意博雷尔集不止包含开集和闭集, 例如博雷尔集包含半开半闭区间, 但它既不是开集也不是闭集

所谓**开集**的一般性定义是 TODO, 在 $\mathbb{R}$ 上开集的定义是 TODO

所谓**闭集**的一般性定义是 TODO, 在 $\mathbb{R}$ 上闭集的定义是 TODO

在连续情形下, 一般是在 $\mathbb{R}$ 上定义概率密度函数, 而概率测度里的积分需要对任意**博雷尔**集上有定义, 严格的说, 这个积分是**勒贝格积分**而不是高等代数里的**黎曼积分**. 而同时满足这两个条件概率密度函数可以保证概率测度是**良定义**的, 即:

(1) $\int_{-\infty}^{+\infty}{p(x)}{dx}=1$

(2) $p(x)\geq 0, \forall x\in\mathbb{R}$

在其他的讨论里, 例如讨论期望和方差时, 还一般会假定概率密度函数的**矩的存在性**, 一般还会做一些关于概率密度函数连续性之类的假定. 但这些条件不是必须的, 甚至于不一定需要定义密度函数, 只需要概率测度 $P$ 有定义即可. 这些关于 $\mathcal{F}$, 以及**勒贝格积分**之类的讨论属于**高等概率论**的范畴

以下讨论主要是对离散型和连续型概率空间:

- 离散型概率空间的概率测度可以完全由概率质量函数 (Probability Mass Function, PMF) 刻画: 一对一的关系
- 连续型概率空间的概率测度可以由概率密度函数 (Probability Density Function, PDF) 刻画: 概率密度函数 -> 概率测度应该是单射, 但可能不一定是双射, TODO, 待确认?

### 正态分布及性质

**一元正态分布**

$$
\mathcal{N}(\mu,\sigma^2)\sim \frac{1}{\sigma\sqrt{2\pi}}e^{-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^2}
$$

特别地, 一元标准正态分布的概率密度函数是

$$
\mathcal{N}(0, 1)\sim \frac{1}{\sqrt{2\pi}}e^{-\frac{1}{2}x^2}
$$

**多元正态分布**

$$
\mathcal{N}(\boldsymbol{\mu},\Sigma)\sim\frac{1}{\sqrt{2\pi}^k}\cdot\frac{1}{\sqrt{\text{det}(\Sigma)}}\exp\left(-\frac{1}{2}(\mathbf{x}-\boldsymbol{\mu})^T\Sigma^{-1}(\mathbf{x}-\boldsymbol{\mu})\right)
$$

特别地, 多元标准正态分布地概率密度函数

$$
\mathcal{N}(\mathbf{0},I)\sim \frac{1}{\sqrt{2\pi}^k}\exp(-\frac{1}{2}\mathbf{x}^T\mathbf{x})
$$

两个多元正态分布的 KL 散度:

$$
D_{KL}(\mathcal{N}(\boldsymbol{\mu}_1,\Sigma_1)\parallel\mathcal{N}(\boldsymbol{\mu}_2,\Sigma_2)) = \frac{1}{2}\left(\text{tr}(\Sigma_2^{-1}\Sigma_1)-k+(\boldsymbol{\mu}_2-\boldsymbol{\mu}_1)^T\Sigma_2^{-1}(\boldsymbol{\mu}_2-\boldsymbol{\mu}_1)+\ln\frac{\text{det}\Sigma_2}{\text{det}\Sigma_1}\right)
$$

特别地:

$$
D_{KL}(\mathcal{N}(\boldsymbol{\mu},\Sigma)\parallel\mathcal{N}(\mathbf{0},I)) = \frac{1}{2}\left(\text{tr}(\Sigma)-k+\boldsymbol{\mu}^T\boldsymbol{\mu}-\ln(\text{det}\Sigma)\right)
$$

更特别地, 如果 $\Sigma$ 是对角阵, 且对角元素为 $\sigma_1,...,\sigma_k$, 那么:

$$
D_{KL}(\mathcal{N}(\boldsymbol{\mu},\text{diag}(\sigma_1,...,\sigma_k))\parallel\mathcal{N}(\mathbf{0}, I)) = \frac{1}{2}\left(\sum_{i=1}^{k}{2(\sigma_i-\ln\sigma_i)}-k+\boldsymbol{\mu}^T\boldsymbol{\mu}\right)
$$

反过来, 特别地

$$
D_{KL}(\mathcal{N}(\mathbf{0},I) \parallel \mathcal{N}(\boldsymbol{\mu},\Sigma))=\frac{1}{2}\left(\text{tr}(\Sigma^{-1})-k+\boldsymbol{\mu}\Sigma^{-1}\boldsymbol{\mu}+\ln(\text{det}\Sigma)\right)
$$

更特别地

$$
D_{KL}(\mathcal{N}(\mathbf{0},I) \parallel \mathcal{N}(\boldsymbol{\mu},\text{diag}(\sigma_1,...,\sigma_k)))=\frac{1}{2}\left(\sum_{i=1}^{k}{2(\frac{1}{\sigma_i}+\ln\sigma_i)}-k+\sum_{i=1}^{k}\sigma_i^2\mu_i^2\right)
$$

### KL 散度

KL 散度在离散型和连续型概率空间上有定义, 在部分混合型分布上也可以有定义, 我们只考虑连续型和离散型的情况. KL 散度用于刻画两个分布间的“距离”, 具有**非负性**, **非对称性**.

**离散型**

$$
D_{KL}(P\parallel Q)=\sum_{x\in\mathcal{X}}{P(x)\ln\frac{P(x)}{Q(x)}}
$$

其中 $\mathcal{X}$ 是样本空间, $P(x)$ 与 $Q(x)$ 是两个概率测度对应的概率质量函数

**连续型**

$$
D_{KL}(P\parallel Q)=\int_{-\infty}^{+\infty}{p(x)\ln\frac{p(x)}{q(x)}}dx
$$

其中 $p(x)$ 与 $q(x)$ 是两个概率测度对应的概率密度函数
