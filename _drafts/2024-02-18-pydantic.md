---
layout: post
title: "(P1) pydantic tutorial"
date: 2024-02-18 11:10:04 +0800
labels: [python]
---

## 动机、参考资料、涉及内容

`openai-python`, `langchain`, `llama_index`, `fastapi` 等项目大量用到了 `pydantic`, 并且 `pydantic` 本身也有 V1 版本与 V2 版本的区别. 对 V1 版本的使用方式是 `pydantic.v1`

Questions:

- `BaseModel` 里的 `Config` 是什么
- 装饰器 `root_validator`
- langchain: `AIMessage.update_forward_refs()`
- [json-schema](https://json-schema.org/learn/getting-started-step-by-step), 有可能另起一篇
- 较新版的 fastapi 应该使用 v2, 但怎么做到客户端可以多传一些参数, 接口调用正常, 并且服务端怎么获取在 BaseModel 校验前的原始参数


### V1 to V2

#### bump-pydantic

以 [add default none](https://github.com/pydantic/bump-pydantic/blob/4aa32788c028c6d0b2066b0ca52db8fe127ef07e/bump_pydantic/codemods/add_default_none.py) 为例, 探究实现细节.

**转换前**

```python
# repo_folder/my_package/a.py
from pydantic import BaseModel

class Foo(BaseModel):
    bar: Optional[str]
    baz: Union[str, None]
    qux: Any
```

**转换方法**

```bash
pip install bump-pydantic
cd repo_folder
bump-pydantic my_package
```

**转换后**

```python
# repo_folder/my_package/a.py
from pydantic import BaseModel

class Foo(BaseModel):
    bar: Optional[str] = None
    baz: Union[str, None] = None
    qux: Any = None
```

